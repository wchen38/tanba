{% extends "restaurant/base.html" %}
{% block content %}
<div class="hero-image">
    <div class="hero-text">
        <h1 class="abril-font-reg-400"> Our Menu </h1>
    </div>
</div>
<div class="container">
    {% for category, items in menu.items %}
        <h2 class="abril-font-reg-400 py-5"> {{ category }}</h2>
        <div class="row card-deck">
            {% for item in items %}

                <div class="col-sm-4 p-0" style="width: 18rem;">
                    <div class="p-0 border m-2 b-radius">
                        <img class="card-img-top" src="{{item.picture.url}}" alt="Card image cap">
                        <div class="card-body">
                            <h5 class="card-title">{{ item.name }}</h5>
                            <h5 class="card-title">{{ item.price }}</h5>
                            <p class="card-text">{{ item.description }}</p>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-sm">
                                    <a data-name="{{ item.name }}" data-price="{{ item.price }}" data-desc="{{ item.description }}" class="text-white btn btn-primary">Add to Cart</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            {% endfor %}
        </div>

    {% endfor %}
</div>

<script type="text/javascript">
    $( document ).ready(function() {
        $(".btn").click(function(e){
            const btnText = $(this).attr('class');
            const checkmark = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check align-bottom" viewBox="0 0 20 20"> \
  <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"></path> \
</svg>'
            if ($(this).parent().parent().find('svg').length == 0) {
                $(this).append(checkmark);
                $(this).parent().parent().append('<div class="d-flex justify-content-center align-items-center"><a href="{% url "checkout_detail" %}" class="col-sm align-middle">view cart</a></div>');
                console.log(btnText);
            }

            addItemToCart(this)
        });

        function addItemToCart(context) {
            let name = context.getAttribute("data-name");
            let price = context.getAttribute("data-price");
            let desc = context.getAttribute("data-desc");
            
            let localCart = localStorage.getItem("cart");
            let cart;
            if(localCart === null) {
                cart = {
                    [name]: {
                        price: price,
                        desc: desc,
                        quantity: 1,
                    }
                }
                localStorage.setItem("cart", JSON.stringify(cart));
                return;
            }
            try {
                cart = JSON.parse(localCart);
                console.log(cart)
                if(cart.hasOwnProperty(name)) {  
                    cart[name].quantity += 1;
                } else {
                    cart[name] = {
                        price: price,
                        desc: desc,
                        quantity: 1,
                    }
                }
                localStorage.setItem("cart", JSON.stringify(cart));
            } catch (e) {
                console.log("Encountered error while parsing the object from local storage: " + e);
            }
            
        }
    });

</script>

{% endblock content %}